# Миграция с Node.js на Python FastAPI

## Обзор изменений

Серверная часть приложения была полностью переписана с Node.js/Express на Python/FastAPI, сохранив всю функциональность оригинального приложения.

## Что было переписано

### 1. Основная структура
- **Было**: Express.js сервер с модульной структурой
- **Стало**: FastAPI приложение с современной архитектурой

### 2. База данных
- **Было**: Prisma ORM + PostgreSQL
- **Стало**: SQLAlchemy ORM + PostgreSQL (с поддержкой Alembic для миграций)

### 3. Аутентификация
- **Было**: JWT с jsonwebtoken + bcrypt
- **Стало**: JWT с python-jose + passlib[bcrypt]

### 4. Валидация данных
- **Было**: express-validator
- **Стало**: Pydantic модели и схемы

### 5. Загрузка файлов
- **Было**: multer
- **Стало**: FastAPI UploadFile

## Сохраненная функциональность

### API Endpoints (полностью совместимы)
- `POST /auth/register` - Регистрация пользователя
- `POST /auth/login` - Вход в систему
- `GET /auth/me` - Получение профиля пользователя
- `GET /my-tickets` - Получение билетов пользователя
- `GET /posts` - Получение всех событий
- `GET /posts/{id}` - Получение конкретного события
- `GET /tags` - Получение популярных тегов
- `GET /tags/{name}` - Получение событий по тегу
- `POST /posts` - Бронирование билета
- `DELETE /posts` - Отмена бронирования
- `POST /upload` - Загрузка файлов

### Модели данных
- **User**: user_id, full_name, email, password_hash, avatar_url, create_timestamp
- **Post**: post_id, text, title, tags, views_count, image_url, created_at
- **posts_users**: связующая таблица для many-to-many отношения

### Бизнес-логика
- Хеширование паролей с bcrypt
- JWT токены для аутентификации
- Автоматическое увеличение счетчика просмотров
- Бронирование/отмена билетов
- Поиск по тегам
- Статистика тегов по просмотрам

## Новые возможности

### 1. Автоматическая документация API
- Swagger UI доступен по адресу `/docs`
- ReDoc доступен по адресу `/redoc`

### 2. Типизация
- Полная типизация с Pydantic
- Автоматическая валидация данных
- Автодополнение в IDE

### 3. Миграции базы данных
- Alembic для управления схемой БД
- Версионирование изменений

### 4. Современная архитектура
- Dependency Injection
- Async/await поддержка (готова к использованию)
- Middleware для CORS
- Структурированное логирование

## Файловая структура

```
server/
├── main.py              # Основное FastAPI приложение
├── models.py            # SQLAlchemy модели
├── schemas.py           # Pydantic схемы
├── crud.py              # CRUD операции
├── auth.py              # Аутентификация и авторизация
├── database.py          # Настройка подключения к БД
├── config.py            # Конфигурация приложения
├── seed.py              # Заполнение БД тестовыми данными
├── run.py               # Скрипт запуска
├── test_api.py          # Тестирование API
├── requirements.txt     # Python зависимости
├── alembic.ini          # Конфигурация миграций
├── alembic/             # Папка миграций
├── README.md            # Документация
├── INSTALL.md           # Инструкция по установке
└── MIGRATION_SUMMARY.md # Этот файл
```

## Преимущества новой версии

1. **Производительность**: FastAPI один из самых быстрых Python фреймворков
2. **Типизация**: Полная поддержка типов Python
3. **Документация**: Автоматическая генерация OpenAPI документации
4. **Современность**: Использует современные Python практики
5. **Масштабируемость**: Легко добавлять новые endpoints
6. **Тестируемость**: Встроенная поддержка тестирования

## Совместимость с фронтендом

API полностью совместим с существующим React фронтендом. Все endpoints возвращают те же данные в том же формате.

## Следующие шаги

1. Установить зависимости: `pip install -r requirements.txt`
2. Настроить `.env` файл с параметрами БД
3. Запустить `python seed.py` для инициализации БД
4. Запустить сервер: `python run.py`
5. Протестировать API: `python test_api.py`

## Поддержка

При возникновении проблем:
1. Проверьте логи сервера
2. Убедитесь, что PostgreSQL запущен
3. Проверьте настройки в `.env` файле
4. Используйте документацию API по адресу `/docs`
